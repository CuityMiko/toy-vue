<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style>
      body {
        width: 980px;
        margin: auto;
        padding: 50px 0;
        display: flex;
        align-items: center;
      }
      textarea {
        display: block;
        width: 420px;
        height: 400px;
      }
      button {
        height: 40px;
        flex-grow: 1;
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <textarea id='from'>
      <input type="text" v-model="text">
      {{text}}
    </textarea>
    <button id='transform'>transform -></button>
    <textarea id='to'></textarea>
    <script src='./compiler/html-parser.js'></script>
    <script>
      /*
      with(this){return _c('div',[_c('input',{directives:[{name:"model",rawName:"v-model",value:(text),expression:"text"}],attrs:{"type":"text"},domProps:{"value":(text)},on:{"input":function($event){if($ev
      ent.target.composing)return;text=$event.target.value}}}),_c('p',[_v(_s(text))])])}
       */
      document.querySelector('#transform').onclick = () => {
        let results = 'with(this) { return ';
        window.HTMLParser(document.querySelector('#from').value, {
          start(tag, attrs, unary) {
            results += `<${tag}`;

            for (let i = 0; i < attrs.length; i += 1) {
              results += ` ${attrs[i].name}="${attrs[i].escaped}"`;
            }

            results += `${unary ? '/' : ''}>`;
          },
          end(tag) {
            results += `</${tag}>`;
          },
          chars(text) {
            results += text;
          },
          comment(text) {
            results += `<!--${text}-->`;
          },
        });

        results += '}';
        document.querySelector('#to').value = results;
      };
    </script>
  </body>
</html>
